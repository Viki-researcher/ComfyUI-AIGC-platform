# AGENTS.md

## Cursor Cloud specific instructions

### Project overview

This is a **Data Generation Platform** (菲特数据生成平台) monorepo with three sub-projects:

| Directory | Role | Tech |
|-----------|------|------|
| `art-design-pro/` | Primary Frontend | Vue 3 + Vite + Element Plus + TypeScript |
| `vue-fastapi-admin-main/` | Backend API | Python FastAPI + Tortoise ORM + SQLite/PostgreSQL |
| `ComfyUI-master-fitow/` | AI Engine (optional) | Customized ComfyUI fork (not needed for dev) |

### Running services

**Backend** (port 9999):
```bash
cd /workspace/vue-fastapi-admin-main
source .venv/bin/activate
DB_DEFAULT_CONNECTION=sqlite python run.py
```
- Uses SQLite by default in dev (no PostgreSQL needed). Set `DB_DEFAULT_CONNECTION=sqlite` env var.
- Auto-creates `db.sqlite3` and runs migrations on first startup.
- Default admin: `admin` / `123456`
- API docs at `http://localhost:9999/docs`
- The `COMFYUI_REPO_PATH is empty` warning is expected and harmless in dev.

**Frontend** (port 3006):
```bash
cd /workspace/art-design-pro
pnpm dev --host 0.0.0.0 --port 3006 --open false
```
- Proxies `/api/*` requests to backend at `http://127.0.0.1:9999` (configured in `.env.development`).
- Login drag verification is disabled by `VITE_DISABLE_DRAG_VERIFY=true` in `.env.development`.

### Lint / check commands

- **Frontend lint**: `cd art-design-pro && pnpm lint` (ESLint requires `.auto-import.json` which is generated by running `pnpm dev` at least once)
- **Frontend format**: `cd art-design-pro && pnpm fix`
- **Backend lint**: `cd vue-fastapi-admin-main && source .venv/bin/activate && ruff check ./app`
- **Backend format**: `cd vue-fastapi-admin-main && source .venv/bin/activate && black ./ && isort ./ --profile black`

### AI Chat / LLM feature

The platform includes an AI chat system. See `docs/llm-chat-config.md` for full configuration. Key points:
- Configure `LLM_PROVIDER`, `LLM_API_KEY`, `LLM_MODEL` env vars before using chat
- Supports multiple LLM providers via OpenAI-compatible protocol (see `docs/llm-chat-config.md`)
- RAG document upload supports txt/md/pdf/docx
- Chat SSE endpoint is excluded from audit log middleware to avoid JSON parse errors
- **Cloud VM network caveat**: Some LLM API endpoints may be unreachable from Cursor Cloud VM (TLS connects but data transfer hangs). OpenAI API works fine. For local dev, all providers should work normally.

### Gotchas

- ESLint will fail if `.auto-import.json` does not exist. Running `pnpm dev` briefly (even with a timeout) generates it.
- The backend's `uvicorn` reload watcher may trigger a harmless `CancelledError` in `comfyui_history_sync` on the first startup (when migration files are created). This is transient and resolves on auto-reload.
- The frontend's Vite dev server can consume significant memory. In memory-constrained environments, avoid opening multiple browser tabs simultaneously.
- The backend venv is at `vue-fastapi-admin-main/.venv/`. System Python is 3.12 which satisfies the `>=3.11` requirement.
