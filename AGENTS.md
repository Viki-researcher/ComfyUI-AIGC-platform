# AGENTS.md

## Cursor Cloud specific instructions

### Architecture overview

This is a **Data Generation Platform** (数据生成平台) monorepo with three components:

| Component | Tech | Port | Required |
|---|---|---|---|
| `art-design-pro/` | Vue 3 + Vite + Element Plus + TailwindCSS | 3006 | Yes |
| `vue-fastapi-admin-main/` | FastAPI + Tortoise ORM + Aerich | 9999 | Yes |
| `ComfyUI-master-fitow/` | ComfyUI (AI image gen engine) | 8200+ | Optional |

### Running the backend

Default mode uses PostgreSQL. Ensure PostgreSQL is running with `data_generation` database:

```bash
cd /workspace/vue-fastapi-admin-main
DB_DEFAULT_CONNECTION=postgres \
POSTGRES_HOST=127.0.0.1 POSTGRES_PORT=5432 POSTGRES_USER=postgres POSTGRES_PASSWORD=postgres POSTGRES_DB=data_generation \
COMFYUI_REPO_PATH=/workspace/ComfyUI-master-fitow \
COMFYUI_PYTHON=/usr/bin/python3 \
COMFYUI_FORCE_CPU=true \
ANNOTATION_TOOL_PATH=/workspace/sam3-annotation-tool \
PYTHONUNBUFFERED=1 \
python3 -m uvicorn app:app --host 0.0.0.0 --port 9999
```

For quick dev without PostgreSQL, use SQLite:
```bash
DB_DEFAULT_CONNECTION=sqlite  # ... same other vars
```

The backend auto-runs DB migrations and seeds default data on startup, including:
- Admin user: `admin` / `123456`
- Default menus, roles, and API entries

### Running the frontend

```bash
cd /workspace/art-design-pro
VITE_PORT=3006 VITE_API_PROXY_URL="http://127.0.0.1:9999" VITE_DISABLE_DRAG_VERIFY="true" \
npx vite --host 0.0.0.0 --port 3006 --open false
```

The Vite dev server proxies `/api` requests to the backend at `http://127.0.0.1:9999`.

### Gotchas

- **ESLint requires `.auto-import.json`**: This file is generated by Vite's `unplugin-auto-import` plugin on first dev server start. You must run the Vite dev server at least once before `pnpm lint` will work in `art-design-pro/`.
- **`pnpm dev` ignores CLI `--port`**: The `dev` script in `package.json` is `vite --open`. To control port, set `VITE_PORT=3006` env var or use `npx vite` directly with `--port`.
- **Backend pip installs to `~/.local/bin`**: Ensure `$HOME/.local/bin` is on `PATH` for `uvicorn`, `ruff`, `aerich`, etc.
- **Pre-existing lint issues**: Both frontend (19 prettier/prettier formatting errors) and backend (4 ruff F841 unused-variable warnings) have pre-existing lint issues that are not blockers.
- **Login API field name**: The login endpoint `POST /api/auth/login` expects `userName` (camelCase), not `username`.

### Lint commands

- Frontend: `cd art-design-pro && pnpm lint`
- Backend: `cd vue-fastapi-admin-main && ruff check ./app`

### Docs

Detailed setup and deployment docs are in `docs/` (Chinese):
- `docs/01_环境与依赖安装.md` — Environment and dependency installation
- `docs/02_PostgreSQL_安装与初始化规范.md` — PostgreSQL setup
- `docs/03_配置说明_前端后端ComfyUI.md` — Configuration reference
- `docs/04_SQLite_to_PostgreSQL_迁移说明.md` — SQLite to PostgreSQL migration guide
- `docs/10_平台启动与停止.md` — Platform start/stop scripts
